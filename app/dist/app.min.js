"use strict";!function(a,b){function c(a,b){var c=a.createElement("p"),d=a.getElementsByTagName("head")[0]||a.documentElement;return c.innerHTML="x<style>"+b+"</style>",d.insertBefore(c.lastChild,d.firstChild)}function d(){var a=t.elements;return"string"==typeof a?a.split(" "):a}function e(a,b){var c=t.elements;"string"!=typeof c&&(c=c.join(" ")),"string"!=typeof a&&(a=a.join(" ")),t.elements=c+" "+a,j(b)}function f(a){var b=s[a[q]];return b||(b={},r++,a[q]=r,s[r]=b),b}function g(a,c,d){if(c||(c=b),l)return c.createElement(a);d||(d=f(c));var e;return e=d.cache[a]?d.cache[a].cloneNode():p.test(a)?(d.cache[a]=d.createElem(a)).cloneNode():d.createElem(a),!e.canHaveChildren||o.test(a)||e.tagUrn?e:d.frag.appendChild(e)}function h(a,c){if(a||(a=b),l)return a.createDocumentFragment();c=c||f(a);for(var e=c.frag.cloneNode(),g=0,h=d(),i=h.length;i>g;g++)e.createElement(h[g]);return e}function i(a,b){b.cache||(b.cache={},b.createElem=a.createElement,b.createFrag=a.createDocumentFragment,b.frag=b.createFrag()),a.createElement=function(c){return t.shivMethods?g(c,a,b):b.createElem(c)},a.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+d().join().replace(/[\w\-:]+/g,function(a){return b.createElem(a),b.frag.createElement(a),'c("'+a+'")'})+");return n}")(t,b.frag)}function j(a){a||(a=b);var d=f(a);return!t.shivCSS||k||d.hasCSS||(d.hasCSS=!!c(a,"article,aside,dialog,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}mark{background:#FF0;color:#000}template{display:none}")),l||i(a,d),a}var k,l,m="3.7.2",n=a.html5||{},o=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,p=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,q="_html5shiv",r=0,s={};!function(){try{var a=b.createElement("a");a.innerHTML="<xyz></xyz>",k="hidden"in a,l=1==a.childNodes.length||function(){b.createElement("a");var a=b.createDocumentFragment();return"undefined"==typeof a.cloneNode||"undefined"==typeof a.createDocumentFragment||"undefined"==typeof a.createElement}()}catch(c){k=!0,l=!0}}();var t={elements:n.elements||"abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output picture progress section summary template time video",version:m,shivCSS:n.shivCSS!==!1,supportsUnknownElements:l,shivMethods:n.shivMethods!==!1,type:"default",shivDocument:j,createElement:g,createDocumentFragment:h,addElements:e};a.html5=t,j(b)}(this,document),function(a){a.matchMedia=a.matchMedia||function(a){var b,c=a.documentElement,d=c.firstElementChild||c.firstChild,e=a.createElement("body"),f=a.createElement("div");return f.id="mq-test-1",f.style.cssText="position:absolute;top:-100em",e.style.background="none",e.appendChild(f),function(a){return f.innerHTML='&shy;<style media="'+a+'"> #mq-test-1 { width: 42px; }</style>',c.insertBefore(e,d),b=42===f.offsetWidth,c.removeChild(e),{matches:b,media:a}}}(a.document)}(this),function(a){function b(){v(!0)}var c={};a.respond=c,c.update=function(){};var d=[],e=function(){var b=!1;try{b=new a.XMLHttpRequest}catch(c){b=new a.ActiveXObject("Microsoft.XMLHTTP")}return function(){return b}}(),f=function(a,b){var c=e();c&&(c.open("GET",a,!0),c.onreadystatechange=function(){4!==c.readyState||200!==c.status&&304!==c.status||b(c.responseText)},4!==c.readyState&&c.send(null))},g=function(a){return a.replace(c.regex.minmaxwh,"").match(c.regex.other)};if(c.ajax=f,c.queue=d,c.unsupportedmq=g,c.regex={media:/@media[^\{]+\{([^\{\}]*\{[^\}\{]*\})+/gi,keyframes:/@(?:\-(?:o|moz|webkit)\-)?keyframes[^\{]+\{(?:[^\{\}]*\{[^\}\{]*\})+[^\}]*\}/gi,comments:/\/\*[^*]*\*+([^/][^*]*\*+)*\//gi,urls:/(url\()['"]?([^\/\)'"][^:\)'"]+)['"]?(\))/g,findStyles:/@media *([^\{]+)\{([\S\s]+?)$/,only:/(only\s+)?([a-zA-Z]+)\s?/,minw:/\(\s*min\-width\s*:\s*(\s*[0-9\.]+)(px|em)\s*\)/,maxw:/\(\s*max\-width\s*:\s*(\s*[0-9\.]+)(px|em)\s*\)/,minmaxwh:/\(\s*m(in|ax)\-(height|width)\s*:\s*(\s*[0-9\.]+)(px|em)\s*\)/gi,other:/\([^\)]*\)/g},c.mediaQueriesSupported=a.matchMedia&&null!==a.matchMedia("only all")&&a.matchMedia("only all").matches,!c.mediaQueriesSupported){var h,i,j,k=a.document,l=k.documentElement,m=[],n=[],o=[],p={},q=30,r=k.getElementsByTagName("head")[0]||l,s=k.getElementsByTagName("base")[0],t=r.getElementsByTagName("link"),u=function(){var a,b=k.createElement("div"),c=k.body,d=l.style.fontSize,e=c&&c.style.fontSize,f=!1;return b.style.cssText="position:absolute;font-size:1em;width:1em",c||(c=f=k.createElement("body"),c.style.background="none"),l.style.fontSize="100%",c.style.fontSize="100%",c.appendChild(b),f&&l.insertBefore(c,l.firstChild),a=b.offsetWidth,f?l.removeChild(c):c.removeChild(b),l.style.fontSize=d,e&&(c.style.fontSize=e),a=j=parseFloat(a)},v=function(b){var c="clientWidth",d=l[c],e="CSS1Compat"===k.compatMode&&d||k.body[c]||d,f={},g=t[t.length-1],p=(new Date).getTime();if(b&&h&&q>p-h)return a.clearTimeout(i),void(i=a.setTimeout(v,q));h=p;for(var s in m)if(m.hasOwnProperty(s)){var w=m[s],x=w.minw,y=w.maxw,z=null===x,A=null===y,B="em";x&&(x=parseFloat(x)*(x.indexOf(B)>-1?j||u():1)),y&&(y=parseFloat(y)*(y.indexOf(B)>-1?j||u():1)),w.hasquery&&(z&&A||!(z||e>=x)||!(A||y>=e))||(f[w.media]||(f[w.media]=[]),f[w.media].push(n[w.rules]))}for(var C in o)o.hasOwnProperty(C)&&o[C]&&o[C].parentNode===r&&r.removeChild(o[C]);o.length=0;for(var D in f)if(f.hasOwnProperty(D)){var E=k.createElement("style"),F=f[D].join("\n");E.type="text/css",E.media=D,r.insertBefore(E,g.nextSibling),E.styleSheet?E.styleSheet.cssText=F:E.appendChild(k.createTextNode(F)),o.push(E)}},w=function(a,b,d){var e=a.replace(c.regex.comments,"").replace(c.regex.keyframes,"").match(c.regex.media),f=e&&e.length||0;b=b.substring(0,b.lastIndexOf("/"));var h=function(a){return a.replace(c.regex.urls,"$1"+b+"$2$3")},i=!f&&d;b.length&&(b+="/"),i&&(f=1);for(var j=0;f>j;j++){var k,l,o,p;i?(k=d,n.push(h(a))):(k=e[j].match(c.regex.findStyles)&&RegExp.$1,n.push(RegExp.$2&&h(RegExp.$2))),o=k.split(","),p=o.length;for(var q=0;p>q;q++)l=o[q],g(l)||m.push({media:l.split("(")[0].match(c.regex.only)&&RegExp.$2||"all",rules:n.length-1,hasquery:l.indexOf("(")>-1,minw:l.match(c.regex.minw)&&parseFloat(RegExp.$1)+(RegExp.$2||""),maxw:l.match(c.regex.maxw)&&parseFloat(RegExp.$1)+(RegExp.$2||"")})}v()},x=function(){if(d.length){var b=d.shift();f(b.href,function(c){w(c,b.href,b.media),p[b.href]=!0,a.setTimeout(function(){x()},0)})}},y=function(){for(var b=0;b<t.length;b++){var c=t[b],e=c.href,f=c.media,g=c.rel&&"stylesheet"===c.rel.toLowerCase();e&&g&&!p[e]&&(c.styleSheet&&c.styleSheet.rawCssText?(w(c.styleSheet.rawCssText,e,f),p[e]=!0):(!/^([a-zA-Z:]*\/\/)/.test(e)&&!s||e.replace(RegExp.$1,"").split("/")[0]===a.location.host)&&("//"===e.substring(0,2)&&(e=a.location.protocol+e),d.push({href:e,media:f})))}x()};y(),c.update=y,c.getEmValue=u,a.addEventListener?a.addEventListener("resize",b,!1):a.attachEvent&&a.attachEvent("onresize",b)}}(this),function(a){a.module("myApp",["myApp.config","myApp.security","myApp.dashboard","myApp.account","myApp.chat","myApp.signin","myApp.routing"]).run(["$rootScope","Auth",function(a,b){b.$onAuth(function(b){a.signedIn=!!b})}])}(angular),angular.module("myApp.config",[]).constant("version","0.0.1").constant("loginRedirectPath","/login").constant("FBURL","https://09sdfgs.firebaseio.com/").run(["FBURL","$timeout",function(a,b){a.match("//INSTANCE.firebaseio.com")&&(angular.element(document.body).html("<h1>Please configure app/config.js before running!</h1>"),b(function(){angular.element(document.body).removeClass("hide")},250))}]),function(a){a.module("myApp.routing",["ngRoute"]).config(["$routeProvider",function(a){a.when("/dashboard",{controller:"DashboardCtrl",templateUrl:"modules/dashboard/view.html",resolve:{user:["Auth",function(a){return a.$waitForAuth()}]}}).when("/chat",{controller:"ChatCtrl",templateUrl:"modules/chat/chat.html"}).when("/signin",{controller:"SigninCtrl",templateUrl:"modules/signin/signin.html"}).whenAuthenticated("/account",{controller:"AccountCtrl",templateUrl:"modules/account/account.html"})}])}(angular),function(a){a.module("myApp").directive("appVersion",["version",function(a){return function(b,c){c.text(a)}}])}(angular),angular.module("firebase.auth",["firebase","firebase.utils"]).factory("Auth",["$firebaseAuth","fbutil",function(a,b){return a(b.ref())}]),angular.module("firebase.utils",["firebase","myApp.config"]).factory("fbutil",["$window","FBURL","$q",function(a,b,c){function d(a){for(var b=0;b<a.length;b++)if(angular.isArray(a[b]))a[b]=d(a[b]);else if("string"!=typeof a[b])throw new Error("Argument "+b+" to firebaseRef is not a string: "+a[b]);return a.join("/")}function e(){var c=new a.Firebase(b),e=Array.prototype.slice.call(arguments);return e.length&&(c=c.child(d(e))),c}var f={handler:function(a,b){return f.defer(function(c){a.call(b,function(a,b){null!==a?c.reject(a):c.resolve(b)})})},defer:function(a,b){var d=c.defer();return a.call(b,d),d.promise},ref:e};return f}]),angular.module("myApp").config(["$provide",function(a){a.decorator("ngCloakDirective",["$delegate","Auth",function(a,b){var c=a[0],d=c.compile;return c.compile=function(a,e){b.$waitForAuth().then(function(){d.call(c,a,e)})},a}])}]),angular.module("myApp").filter("reverse",function(){return function(a){return a.slice().reverse()}}),function(a){var b=[];a.module("myApp.security",["ngRoute","firebase.auth","myApp.config"]).config(["$routeProvider",function(a){a.otherwise({redirectTo:"/signin"})}]).config(["$routeProvider",function(a){a.whenAuthenticated=function(c,d){b.push(c),d.resolve=d.resolve||{},d.resolve.user=["Auth",function(a){return a.$requireAuth()}],a.when(c,d)}}]).run(["$rootScope","$location","Auth","loginRedirectPath",function(a,c,d,e){function f(a){!a&&g(c.path())&&(console.log("check failed",a,c.path()),c.path(e))}function g(a){return console.log("authRequired?",a,b.indexOf(a)),-1!==b.indexOf(a)}d.$onAuth(f),a.$on("$routeChangeError",function(a,b,d,f){"AUTH_REQUIRED"===f&&c.path(e)})}])}(angular),function(a){a.module("myApp.account",["firebase","firebase.auth","firebase.utils","ngRoute"]),a.module("myApp.chat",["firebase","firebase.utils"]),a.module("myApp.dashboard",["firebase","firebase.auth","firebase.utils","ngRoute"]),a.module("myApp.signin",["firebase.auth","firebase.utils","ngRoute"])}(angular),function(a){a.module("myApp.account").controller("AccountCtrl",["$scope","Auth","fbutil","user","$location","$firebaseObject",function(a,b,c,d,e,f){function g(){a.err=null,a.msg=null,a.emailerr=null,a.emailmsg=null}var h,i=f(c.ref("users",d.uid));i.$bindTo(a,"profile").then(function(a){h=a}),a.logout=function(){h&&h(),i.$destroy(),b.$unauth(),e.path("/signin")},a.changePassword=function(c,d,e){g(),c&&d&&e?e!==d?a.err="New pass and confirm do not match":b.$changePassword({email:i.email,oldPassword:c,newPassword:e}).then(function(){a.msg="Password changed"},function(b){a.err=b}):a.err="Please fill in all password fields"},a.clear=g,a.changeEmail=function(e,f){g();var h=i.email;b.$changeEmail({oldEmail:h,newEmail:f,password:e}).then(function(){return c.handler(function(a){c.ref("users",d.uid,"email").set(f,a)})}).then(function(){a.emailmsg="Email changed"},function(b){a.emailerr=b})}}])}(angular),function(a){a.module("myApp.chat").controller("ChatCtrl",["$scope","messageService",function(a,b){a.messages=b,a.addMessage=function(b){b&&a.messages.$add({text:b})}}])}(angular),function(a){a.module("myApp.chat").factory("messageService",["fbutil","$firebaseArray",function(a,b){var c=a.ref("messages").limitToLast(11);return b(c)}])}(angular),function(a){a.module("myApp.dashboard").controller("DashboardCtrl",["$scope","fbutil","user","$firebaseObject","FBURL",function(a,b,c,d,e){a.syncedValue=d(b.ref("syncedValue")),a.user=c,a.FBURL=e}])}(angular),function(a){a.module("myApp.signin").controller("SigninCtrl",["$scope","Auth","$location","fbutil",function(b,c,d,e){function f(){return b.email?b.pass&&b.confirm?b.createMode&&b.pass!==b.confirm&&(b.err="Passwords do not match"):b.err="Please enter a password":b.err="Please enter an email address",!b.err}function g(b){return a.isObject(b)&&b.code?b.code:b+""}function h(a){return i(a.substr(0,a.indexOf("@"))||"")}function i(a){a+="";var b=a.charAt(0).toUpperCase();return b+a.substr(1)}b.email=null,b.pass=null,b.confirm=null,b.createMode=!1,b.signin=function(a,e){b.err=null,c.$authWithPassword({email:a,password:e},{rememberMe:!0}).then(function(){d.path("/account")},function(a){b.err=g(a)})},b.createAccount=function(){if(b.err=null,f()){var a=b.email,i=b.pass;c.$createUser({email:a,password:i}).then(function(){return c.$authWithPassword({email:a,password:i})}).then(function(b){var c=e.ref("users",b.uid);return e.handler(function(b){c.set({email:a,name:name||h(a)},b)})}).then(function(){d.path("/account")},function(a){b.err=g(a)})}}}])}(angular);